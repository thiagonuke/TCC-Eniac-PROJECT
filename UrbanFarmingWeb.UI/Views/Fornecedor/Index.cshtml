
<style>
    * {
        color: white;
    }

    .popup-cadastro {
        display: none;
    }

    body {
        background-color: steelblue;
        color: white;
        font-family: Arial, sans-serif;
    }

    .tabulator {
        background-color: #ffffff !important;
        border-radius: 8px;
        padding: 10px;
    }

        .tabulator,
        .tabulator * {
            color: #000 !important;
        }

    /* Cabeçalho */
    .tabulator-header,
    .tabulator-col,
    .tabulator-col-content {
        color: #000 !important;
        background-color: #fff !important;
    }

    /* Linhas da tabela */
    .tabulator-row {
        color: #000 !important;
        background-color: #fff !important;
    }

        /* Linhas alternadas */
        .tabulator-row:nth-child(even) {
            background-color: #fafafa !important;
        }

    /* Borda das células */
    .tabulator-cell {
        border-color: #000 !important;
        color: #000 !important;
    }

    /* Borda horizontal */
    .tabulator-row .tabulator-cell {
        border-bottom: 1px solid #000 !important;
    }

    /* Ícones, setas, etc. */
    .tabulator-header .tabulator-arrow {
        border-color: #000 transparent transparent transparent !important;
    }

    /* Paginação */
    .tabulator .tabulator-footer {
        color: #000 !important;
    }

    .tabulator .tabulator-paginator button {
        color: #000 !important;
        border-color: #000 !important;
        background-color: #fff !important;
    }
    .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }

    .popup-content {
        background: #fff;
        width: 60vw;
        max-height: 90vh;
        overflow-y: auto;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 0 20px #000;
        position: relative;
        /* CENTRALIZAÇÃO AQUI */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        /* opcional: texto centralizado */
        text-align: center;
    }

    /* X para fechar */
    .btn-fechar {
        position: absolute;
        right: 20px;
        top: 10px;
        font-size: 28px;
        cursor: pointer;
        color: #000;
    }

    /* Título */
    .titulo-popup {
        margin-top: 0;
        color: #000;
    }
</style>
<link href="https://unpkg.com/tabulator-tables@5.5.2/dist/css/tabulator.min.css" rel="stylesheet">

<!doctype html>
<html lang="en">
<body style="background-color: steelblue;">
    <h2 class="mt-2">Fornecedores</h2>
    <hr />
    <div class="row flex justify-content-end">

        <button class="btn btn-light mb-3 w-25" onclick="abrirPopup()">➕ Novo Fornecedor</button>

    </div>

    <div id="tabelaFornecedores" style="height: 520px;"></div>
    <div id="popupOverlay" class="popup-overlay" style="display:none;">
        <div class="popup-content">

            <span class="btn-fechar" onclick="fecharPopup()">×</span>

            <h2 class="titulo-popup">Cadastro de Fornecedor</h2>
            <hr />

            <form class="w-75 flex-column justify-content-center align-items-center" style="color:black;">
                <div class="row flex">
                    <div class="form-group col-md-12">
                        <h3 class="mt-4" style="color:black;">Pessoa Jurídica ou Física</h3>
                        <hr />
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="pessoaTipo" id="pessoaJuridica" value="juridica" onclick="mostrarCampos()" required>
                            <label class="form-check-label text-secondary" for="pessoaJuridica">Pessoa Jurídica (CNPJ)</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="pessoaTipo" id="pessoaFisica" value="fisica" onclick="mostrarCampos()" required>
                            <label class="form-check-label text-secondary" for="pessoaFisica">Pessoa Física (CPF)</label>
                        </div>
                    </div>
                </div>

                <div id="campoCNPJ" style="display: none;">
                    <div class="row flex">
                    <div class="form-group col-md-12">
                        <label for="inputCNPJ" class="text-secondary">CNPJ</label>
                        <input type="text" class="form-control" id="inputCNPJ" placeholder="CNPJ (14 dígitos)" pattern="\d{14}" title="O CNPJ deve conter 14 dígitos">
                    </div>
                        <div class="form-group col-md-12 d-flex flex-column align-items-center">
                            <label for="inputRazaoSocial" class="text-secondary text-center">Razão Social</label>
                            <input type="text" id="inputRazaoSocial" class="form-control" placeholder="Razão Social">
                        </div>
                    <div class="form-group col-md-12 d-flex flex-column align-items-center">
                        <label for="inputNomeFantasia" class="text-secondary">Nome Fantasia</label>
                        <input type="text" id="inputNomeFantasia" class="form-control" placeholder="Nome Fantasia">
                    </div>

                    </div>
                </div>

                <div id="campoCPF" style="display: none;">
                    <div class="form-group col-md-12">
                        <label for="inputCPF" class="text-secondary">CPF</label>
                        <input type="text" class="form-control" id="inputCPF" placeholder="CPF (11 dígitos)" pattern="\d{11}" title="O CPF deve conter 11 dígitos">
                    </div>
                    <div class="form-group col-md-12">
                        <label for="inputNome" class="text-secondary">Nome Completo</label>
                        <input type="text" id="inputNome" class="form-control" placeholder="Nome Completo">
                    </div>
                </div>

                <div class="form-group col-md-12">
                    <label for="inputEmail" class="text-secondary">Email</label>
                    <input type="email" id="inputEmail" class="form-control" placeholder="email@empresa.com" required>
                </div>
                <div class="form-group col-md-12">
                    <label for="inputTelefone" class="text-secondary">Telefone</label>
                    <input type="text" id="inputTelefone" class="form-control" placeholder="Telefone">
                </div>                
                <div class="form-group col-md-12">
                    <label for="inputCEP" class="text-secondary">CEP</label>
                    <input type="text" id="inputCEP" class="form-control" placeholder="CEP">
                </div>
                <div class="form-group col-md-12">
                    <label for="inputEndereco" class="text-secondary">Endereço</label>
                    <input type="text" id="inputEndereco" class="form-control" placeholder="Endereço">
                </div>
                <div class="form-group col-md-12">
                    <label for="inputPaisOrigem" class="text-secondary">País de Origem</label>
                    <input type="text" class="form-control" id="inputPaisOrigem" placeholder="País de Origem">
                </div>
                <div class="form-group col-md-12">
                    <label for="inputMensagemPadrao" class="text-secondary">Mensagem Padrão de E-mail</label>
                    <textarea id="inputMensagemPadrao" class="form-control" rows="4">Olá, um pedido foi realizado pelo sistema Zentrix para a quantidade {quantidade} do produto {produto}.</textarea>
                    <span class="text-danger small" style="font-size: 14px;">
                        Digite aqui a mensagem padrão para envio automático. Você pode usar placeholders como {produto}, {quantidade}, {data}, {codigoPedido}...
                    </span>
                </div>

                <div class="col-md-12 d-flex justify-content-center mt-4">
                    <button type="button" id="btncadastro" onclick="SalvarFornecedor()" class="btn btn-success rounded-3">
                        Cadastrar
                    </button>
                </div>

            </form>
        </div>
    </div>



</body>
</html>
<script src="~/js/jquery.min.js"></script>
<link href="https://unpkg.com/tabulator-tables@5.5.2/dist/css/tabulator.min.css" rel="stylesheet">
<script src="https://unpkg.com/tabulator-tables@5.5.2/dist/js/tabulator.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link href="https://unpkg.com/tabulator-tables@5.5.0/dist/css/tabulator.min.css" rel="stylesheet">
<script src="https://unpkg.com/tabulator-tables@5.5.0/dist/js/tabulator.min.js"></script>   



<script>

    function mostrarCampos() {
        var pessoaJuridica = document.getElementById("pessoaJuridica").checked;
        var pessoaFisica = document.getElementById("pessoaFisica").checked;

        if (pessoaJuridica) {
            document.getElementById("campoCNPJ").style.display = "block";
            document.getElementById("campoCPF").style.display = "none";
        }
        else if (pessoaFisica) {
            document.getElementById("campoCNPJ").style.display = "none";
            document.getElementById("campoCPF").style.display = "block";
        }
    }

    $('#inputCNPJ').on('blur', function () {
        let cnpj = document.getElementById('inputCNPJ').value;
        if (cnpj.length === 14) {
            $.ajax({
                url: `https://www.receitaws.com.br/v1/cnpj/${cnpj}`,
                method: 'GET',
                dataType: 'jsonp',
                success: function (data) {

                    if (data.status === 'OK') {
                        document.getElementById('inputRazaoSocial').value = data.nome;
                        document.getElementById('inputNomeFantasia').value = data.fantasia;
                        document.getElementById('inputEmail').value = data.email || 'N/A';
                        document.getElementById('inputTelefone').value = data.telefone || 'N/A';
                        document.getElementById('inputEndereco').value = `${data.logradouro}, ${data.numero} - ${data.bairro}`;
                        document.getElementById('inputCEP').value = data.cep;
                        document.getElementById('inputPaisOrigem').value = "Brasil";
                    } else {
                        toastr.error('CNPJ inválido ou não encontrado.');
                    }
                },
                error: function () {
                    alert('Erro ao consultar CNPJ.');
                }
            });
        }

    });

    $('#inputCEP').on('blur', function () {
        let cep = $('#inputCEP').val().replace(/[^\d]/g, '');

        if (cep.length !== 8) {
            return;
        }

        $.ajax({
            url: `https://viacep.com.br/ws/${cep}/json/`,
            method: 'GET',
            success: function (data) {

                if (!data.erro) {
                    $('#inputEndereco').val(`${data.logradouro}, ${data.bairro}`);
                } else {
                    alert('CEP não encontrado.');
                }

            },
            error: function () {
                alert('Erro ao consultar o CEP.');
            }
        });
    });

    function SalvarFornecedor() {
        var pessoaJuridica = $('#pessoaJuridica').is(':checked');
        var pessoaFisica = $('#pessoaFisica').is(':checked');

        if (pessoaJuridica != false || pessoaFisica != false){
            showLoading()
            $.ajax({
                url: '../Fornecedor/CadastrarFornecedor',
                method: "POST",
                data: JSON.stringify({
                    Codigo: $('#inputCodigo').val(),
                    RazaoSocial: pessoaJuridica ? $('#inputRazaoSocial').val() : $("#inputNome").val(),
                    NomeFantasia: pessoaJuridica ? $('#inputNomeFantasia').val() : null,
                    CNPJ: pessoaJuridica ? $('#inputCNPJ').val().replace(".", '').replace('/', '').replace('-', '') : null,
                    CPF: pessoaFisica ? $('#inputCPF').val() : null,
                    NomeCompleto: pessoaFisica ? $('#inputNome').val() : null,
                    Email: $('#inputEmail').val(),
                    PaisOrigem: $('#inputPaisOrigem').val(),
                    MensagemPadraoEmail: $('#inputMensagemPadrao').val(),
                    PessoaJuridica: pessoaJuridica,
                    PessoaFisica: pessoaFisica
                }),
                contentType: 'application/json; charset=utf-8',
                success: function (response) {
                    toastr.success("Cadastro realizado com sucesso!");
                    
                    $('#popupOverlay').hide();

                    location.reload();
                },
                error: function (error) {
                    toastr.error("Erro ao realizar o cadastro.");
                }
            });
            hideLoading()
        }else{
            alert("Selecione as opções para prosseguir!")
        }



    }

    function abrirPopup() {
        document.getElementById("popupOverlay").style.display = "flex";
    }

    function fecharPopup() {
        document.getElementById("popupOverlay").style.display = "none";
    }

    function mostrarCampos() {
        let tipo = document.querySelector('input[name="pessoaTipo"]:checked').value;

        if (tipo === "juridica") {
            document.getElementById("campoCNPJ").style.display = "block";
            document.getElementById("campoCPF").style.display = "none";
        } else {
            document.getElementById("campoCNPJ").style.display = "none";
            document.getElementById("campoCPF").style.display = "block";
        }
    }
</script>
<script>
    let tabela = new Tabulator("#tabelaFornecedores", {
        layout: "fitColumns",
        pagination: "local",
        paginationSize: 10,
        height: "520px",
        columns: [
            { title: "Código", field: "codigo", width: 100 },
            { title: "Razão Social", field: "razaoSocial" },
            { title: "Nome Fantasia", field: "nomeFantasia" },
            { title: "CNPJ", field: "cnpj" },
            { title: "País Origem", field: "paisOrigem" },
            { title: "Email", field: "email" },
            {
                title: "PJ",
                field: "pessoaJuridica",
                width: 70,
                hozAlign: "center",
                formatter: cell => cell.getValue() ? "✔️" : "❌"
            },
            {
                title: "PF",
                field: "pessoaFisica",
                width: 70,
                hozAlign: "center",
                formatter: cell => cell.getValue() ? "✔️" : "❌"
            }
        ]
    });

    function carregarFornecedores() {
        $.get("/Fornecedor/GetAllFornecedores", function (dados) {
            console.log(dados); // veja o retorno
            tabela.setData(dados);
        }).fail(() => {
            alert("Erro ao carregar lista de fornecedores.");
        });
    }

    carregarFornecedores();
</script>